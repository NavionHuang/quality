--评审号，工单号，产品编号，产品类型，产品类型名称，工单数量，生产数量，完成率，维修数量，合格率，不良率
SELECT  WS.SHEET_PO,
  WS.SHEET_NO,
  WS.PRODUCT_NO,
  WS.PRODUCT_TYPE_CODE,
  WS.OUTPUT_NUM,COUNT(DISTINCT R.ID) PNUM,NVL(SUM(CASE WHEN R.STATUS = -1
  THEN 1 END), 0) RPNUM  FROM WORK_SHEET WS
LEFT JOIN (SELECT P.ID,P.SHEET_PO,PR.STATUS
FROM PRODUCT P ,PROCESS_RECORD PR
WHERE P.ID = PR.PRODUCT_ID AND PR.STATUS <=0
GROUP BY P.ID,P.SHEET_PO,PR.STATUS) R ON WS.SHEET_PO = R.SHEET_PO
GROUP BY WS.SHEET_PO, WS.SHEET_NO, WS.PRODUCT_NO, WS.PRODUCT_TYPE_CODE, WS.OUTPUT_NUM;


--评审号，工单号，工单数据，线别、生产数量，生产比例（生产数量/工单数量），维修数量，合格率，不良率
SELECT  WS.SHEET_PO,
  WS.SHEET_NO,
  WS.PRODUCT_NO,
  WS.PRODUCT_TYPE_CODE,
  WS.OUTPUT_NUM,PL.NAME AS PRODUCT_LINE_NAME,COUNT(DISTINCT R.ID) PNUM,NVL(SUM(CASE WHEN R.STATUS = -1
  THEN 1 END), 0) RPNUM  FROM WORK_SHEET WS
  LEFT JOIN (SELECT P.ID,P.SHEET_PO,PR.PRODUCT_LINE,PR.STATUS
             FROM PRODUCT P ,PROCESS_RECORD PR
             WHERE P.ID = PR.PRODUCT_ID AND PR.STATUS <=0
             GROUP BY P.ID,P.SHEET_PO,PR.PRODUCT_LINE,PR.STATUS) R ON WS.SHEET_PO = R.SHEET_PO
  LEFT JOIN PRODUCT_LINE PL ON PL.CODE = R.PRODUCT_LINE
GROUP BY WS.SHEET_PO, WS.SHEET_NO, WS.PRODUCT_NO, WS.PRODUCT_TYPE_CODE, WS.OUTPUT_NUM,PL.NAME;

--评审号，工单号，工单数量，站点、生产数量，生产比例（生产数量、工单数量），维修数量，合格率，不良率
SELECT  WS.SHEET_PO,
  WS.SHEET_NO,
  WS.PRODUCT_NO,
  WS.PRODUCT_TYPE_CODE,
  WS.OUTPUT_NUM,P.NAME AS PROCESS_NAME,COUNT(DISTINCT R.ID) PNUM,NVL(SUM(CASE WHEN R.STATUS = -1
  THEN 1 END), 0) RPNUM  FROM WORK_SHEET WS
  LEFT JOIN (SELECT P.ID,P.SHEET_PO,PR.PROCESS_CODE,PR.STATUS
             FROM PRODUCT P ,PROCESS_RECORD PR
             WHERE P.ID = PR.PRODUCT_ID AND PR.STATUS <=0
             GROUP BY P.ID,P.SHEET_PO,PR.PROCESS_CODE,PR.STATUS) R ON WS.SHEET_PO = R.SHEET_PO
  LEFT JOIN PROCESS P ON P.CODE = R.PROCESS_CODE
GROUP BY WS.SHEET_PO, WS.SHEET_NO, WS.PRODUCT_NO, WS.PRODUCT_TYPE_CODE, WS.OUTPUT_NUM,P.NAME;
--产品id,评审号，产品编号，产品sn,玻璃sn,邦板sn,维修次数，当前工作
select p.id,p.SHEET_PO,pr.PROCESS_CODE,sum(-1*pr.STATUS) repariNum
from product p left join PROCESS_RECORD pr on p.id = pr.PRODUCT_ID
where pr.STATUS <=0
group by p.id,p.SHEET_PO,pr.PROCESS_CODE;